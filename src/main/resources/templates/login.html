<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestor de Grupos - Login</title>
    <link rel="stylesheet" th:href="@{/css/login.css}" />
  </head>
  <body>
    <div class="login-container">
      <div class="form-header">
        <h1 class="logo">Gestor de Grupos</h1>
        <p class="form-subtitle">Organiza y gestiona tus proyectos en equipo</p>

        <div class="form-toggle">
          <button type="button" class="toggle-btn active" onclick="showLogin()">
            Iniciar Sesión
          </button>
          <button type="button" class="toggle-btn" onclick="showRegister()">
            Registrarse
          </button>
        </div>
      </div>

      <!-- Mensajes de Error y Éxito-->
      <div class="form-content">
        <!-- Mensajes Flash -->
        <div th:if="${error}" class="alert alert-error">
          <span class="alert-icon">❌</span>
          <span th:text="${error}">Error message</span>
        </div>

        <div th:if="${warning}" class="alert alert-warning">
          <span class="alert-icon">⚠️</span>
          <span th:text="${message}">Warning message</span>
        </div>

        <div th:if="${success}" class="alert alert-success">
          <span class="alert-icon">✅</span>
          <span th:text="${success}"></span>
        </div>

        <!-- Formulario de Login -->
        <div id="loginForm" class="form-section active">
          <form th:action="@{/authenticate}" method="post">
            <div class="form-group">
              <label for="loginEmail" class="form-label"
                >Correo Electrónico</label
              >
              <input
                type="email"
                id="loginEmail"
                name="user"
                class="form-input"
                placeholder="tu@email.com"
                required
              />
            </div>

            <div class="form-group">
              <label for="loginPassword" class="form-label">Contraseña</label>
              <input
                type="password"
                id="loginPassword"
                name="password"
                class="form-input"
                placeholder="••••••••"
                required
              />
            </div>

            <button type="submit" class="submit-btn">Iniciar Sesión</button>
          </form>

          <div class="forgot-password">
            <a href="#" onclick="showForgotPassword()"
              >¿Olvidaste tu contraseña?</a
            >
          </div>
        </div>

        <!-- Formulario de Registro -->
        <div id="registerForm" class="form-section">
          <form
            th:action="@{/register}"
            th:object="${registroDTO}"
            method="post"
            onsubmit="return validateRegisterForm()"
          >
            <div class="form-group half">
              <div>
                <label for="registerNombre" class="form-label">Nombre</label>
                <input
                  type="text"
                  id="registerNombre"
                  th:field="*{nombre}"
                  class="form-input"
                  placeholder="Juan"
                  required
                />
              </div>
              <div>
                <label for="registerApellido" class="form-label"
                  >Apellido</label
                >
                <input
                  type="text"
                  id="registerApellido"
                  th:field="*{apellido}"
                  class="form-input"
                  placeholder="Pérez"
                  required
                />
              </div>
            </div>

            <div class="form-group">
              <label for="registerEmail" class="form-label"
                >Correo Electrónico</label
              >
              <input
                type="email"
                id="registerEmail"
                th:field="*{correo}"
                class="form-input"
                placeholder="tu@email.com"
                required
              />
            </div>

            <div class="form-group">
              <label for="registerPassword" class="form-label"
                >Contraseña</label
              >
              <input
                type="password"
                id="registerPassword"
                th:field="*{password}"
                class="form-input"
                placeholder="••••••••"
                required
                onkeyup="checkPasswordStrength()"
              />

              <div class="password-requirements" id="passwordRequirements">
                <div class="requirement" id="req-length">
                  <div class="requirement-icon">●</div>
                  <span>Mínimo 8 caracteres</span>
                </div>
                <div class="requirement" id="req-uppercase">
                  <div class="requirement-icon">●</div>
                  <span>Al menos una mayúscula</span>
                </div>
                <div class="requirement" id="req-number">
                  <div class="requirement-icon">●</div>
                  <span>Al menos un número</span>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="confirmPassword" class="form-label"
                >Confirmar Contraseña</label
              >
              <input
                type="password"
                id="confirmPassword"
                th:field="*{confirmarPassword}"
                class="form-input"
                placeholder="••••••••"
                required
                onkeyup="checkPasswordMatch()"
              />
            </div>

            <button type="submit" class="submit-btn">Crear Cuenta</button>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Limpiar mensajes flash después de mostrarlos
      setTimeout(() => {
        const alerts = document.querySelectorAll(".alert");
        alerts.forEach((alert) => {
          alert.style.animation = "slideUp 0.3s ease-in forwards";
          setTimeout(() => alert.remove(), 300);
        });
      }, 5000);

      function showLogin() {
        document.getElementById("loginForm").classList.add("active");
        document.getElementById("registerForm").classList.remove("active");

        document.querySelectorAll(".toggle-btn")[0].classList.add("active");
        document.querySelectorAll(".toggle-btn")[1].classList.remove("active");
      }

      function showRegister() {
        document.getElementById("registerForm").classList.add("active");
        document.getElementById("loginForm").classList.remove("active");

        document.querySelectorAll(".toggle-btn")[1].classList.add("active");
        document.querySelectorAll(".toggle-btn")[0].classList.remove("active");
      }

      function showForgotPassword() {
        // Aquí puedes implementar la funcionalidad de recuperar contraseña
        alert("Funcionalidad de recuperar contraseña próximamente");
      }

      function checkPasswordStrength() {
        const password = document.getElementById("registerPassword").value;

        // Verificar longitud
        const lengthReq = document.getElementById("req-length");
        if (password.length >= 8) {
          lengthReq.classList.add("valid");
          lengthReq.querySelector(".requirement-icon").textContent = "✓";
        } else {
          lengthReq.classList.remove("valid");
          lengthReq.querySelector(".requirement-icon").textContent = "●";
        }

        // Verificar mayúscula
        const uppercaseReq = document.getElementById("req-uppercase");
        if (/[A-Z]/.test(password)) {
          uppercaseReq.classList.add("valid");
          uppercaseReq.querySelector(".requirement-icon").textContent = "✓";
        } else {
          uppercaseReq.classList.remove("valid");
          uppercaseReq.querySelector(".requirement-icon").textContent = "●";
        }

        // Verificar número
        const numberReq = document.getElementById("req-number");
        if (/\d/.test(password)) {
          numberReq.classList.add("valid");
          numberReq.querySelector(".requirement-icon").textContent = "✓";
        } else {
          numberReq.classList.remove("valid");
          numberReq.querySelector(".requirement-icon").textContent = "●";
        }

        // Verificar coincidencia de contraseñas
        checkPasswordMatch();
      }

      function checkPasswordMatch() {
        const password = document.getElementById("registerPassword").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const confirmInput = document.getElementById("confirmPassword");

        if (confirmPassword.length > 0) {
          if (password === confirmPassword) {
            confirmInput.classList.remove("error");
            confirmInput.style.borderColor = "#10b981";
          } else {
            confirmInput.classList.add("error");
          }
        } else {
          confirmInput.classList.remove("error");
          confirmInput.style.borderColor = "#e2e8f0";
        }
      }

      function validateRegisterForm() {
        const password = document.getElementById("registerPassword").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;

        // Validar fortaleza de contraseña
        if (
          password.length < 8 ||
          !/[A-Z]/.test(password) ||
          !/\d/.test(password)
        ) {
          alert(
            "La contraseña debe cumplir con todos los requisitos de seguridad."
          );
          return false;
        }

        // Validar coincidencia de contraseñas
        if (password !== confirmPassword) {
          alert("Las contraseñas no coinciden.");
          return false;
        }

        return true;
      }

      // Animación de desvanecimiento para alerts
      const style = document.createElement("style");
      style.textContent = `
            @keyframes slideUp {
                to {
                    opacity: 0;
                    transform: translateY(-10px);
                }
            }
        `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
